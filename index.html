---
---
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>{{ site.title }}</title>
  <style>
    body {
      font-family: Arial, Helvetica, sans-serif;
      padding: 20px;
    }
    .section {
      margin-bottom: 20px;
    }
    .item {
      cursor: pointer;
      padding: 10px;
      border: 1px solid #ccc;
      margin: 5px;
      display: inline-block;
    }
    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 10px;
      justify-items: center;
    }
    .gallery img {
      max-width: 100%;
      height: auto;
      cursor: zoom-in;
      transition: transform 0.2s;
    }
    .gallery img:hover {
      transform: scale(1.05);
    }
    .back {
      margin: 10px 0;
      display: inline-block;
      cursor: pointer;
      color: blue;
    }
    .label {
      font-weight: 700;
      margin-right: 8px;
    }
    .count {
      color: #666;
      margin-left: 6px;
      font-size: 90%;
    }
  </style>
</head>
<body>
  <h1>{{ site.full_name }}</h1>

  <div class="section">
    <span class="label">Albums:</span>
    <div id="albums" style="display:inline-block"></div>
  </div>

  <div class="section">
    <span class="label">Categories:</span>
    <div id="categories" style="display:inline-block"></div>
  </div>

  <div id="gallery" style="display:none"></div>

  <script>
    // Build an array of image file paths at build time using Jekyll's site.static_files
    var files = [
      {% for file in site.static_files %}
        {% assign p = file.path %}
        {% if p contains 'images/' and (p contains '.jpg' or p contains '.jpeg' or p contains '.png' or p contains '.gif' or p contains '.webp') %}
          "{{ file.path | relative_url }}",
        {% endif %}
      {% endfor %}
    ];

    // Maps and sets for albums and categories
    var albumsMap = {}; // albumName => [paths]
    var categoriesMap = {}; // categoryKey => { display: originalFirstWord, items: [paths] }

    files.forEach(function(path){
      // Normalize and split: expect paths like /images/<album>/<file>
      var parts = path.replace(/^\/+/,'').split('/');
      if(parts.length < 3) return; // need images/<album>/<file>

      var album = parts[1];
      albumsMap[album] = albumsMap[album] || [];
      albumsMap[album].push(path);

      var filename = parts[parts.length - 1];
      var base = filename.replace(/\.[^/.]+$/, '');
      // Get the first word: split on non-alphanumeric characters
      var first = base.split(/[^A-Za-z0-9]+/)[0] || base;
      var key = first.toLowerCase();
      var display = first.charAt(0).toUpperCase() + first.slice(1);
      categoriesMap[key] = categoriesMap[key] || { display: display, items: [] };
      categoriesMap[key].items.push(path);
    });

    var albumsEl = document.getElementById('albums');
    var categoriesEl = document.getElementById('categories');
    var galleryEl = document.getElementById('gallery');

    function renderAlbums(){
      albumsEl.innerHTML = '';
      Object.keys(albumsMap).sort().forEach(function(album){
        var el = document.createElement('div');
        el.className = 'item';
        el.textContent = album + ' ';
        var count = document.createElement('span');
        count.className = 'count';
        count.textContent = '(' + albumsMap[album].length + ')';
        el.appendChild(count);
        el.onclick = function(){ openGallery(album, albumsMap[album], 'Album: ' + album); };
        albumsEl.appendChild(el);
      });
    }

    function renderCategories(){
      categoriesEl.innerHTML = '';
      Object.keys(categoriesMap).sort().forEach(function(key){
        var c = categoriesMap[key];
        var el = document.createElement('div');
        el.className = 'item';
        el.textContent = c.display + ' ';
        var count = document.createElement('span');
        count.className = 'count';
        count.textContent = '(' + c.items.length + ')';
        el.appendChild(count);
        el.onclick = function(){ openGallery(c.display, c.items, 'Category: ' + c.display); };
        categoriesEl.appendChild(el);
      });
    }

    function openGallery(name, items, title){
      albumsEl.style.display = 'none';
      categoriesEl.style.display = 'none';
      galleryEl.style.display = 'block';
      galleryEl.innerHTML = '<div class="back" onclick="closeGallery()">‚Üê Back</div><h2>' + (title || name) + '</h2>';
      items.forEach(function(src){
        var img = document.createElement('img');
        img.src = src;
        img.alt = name;
        img.style.cursor = 'zoom-in';
        img.onclick = function() {
          if (img.style.transform === 'scale(2)') {
            img.style.transform = 'scale(1)';
            img.style.cursor = 'zoom-in';
          } else {
            img.style.transform = 'scale(2)';
            img.style.cursor = 'zoom-out';
          }
        };
        galleryEl.appendChild(img);
      });
      window.scrollTo(0,0);
    }

    function closeGallery(){
      galleryEl.style.display = 'none';
      albumsEl.style.display = 'inline-block';
      categoriesEl.style.display = 'inline-block';
      galleryEl.innerHTML = '';
    }

    renderAlbums();
    renderCategories();
  </script>

  

  <footer style="margin-top:20px;text-align:center;color:#666;font-size:90%;">
    Thank you for visiting Memories in Pixel. &copy; {{ site.time | date: "%Y" }}.
  </footer>
</body>
</html>