<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>{{ site.title }}</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;padding:20px;background:#fff;color:#222}
    .section{margin-bottom:20px}
    .item{cursor:pointer;padding:8px;border:1px solid #ccc;margin:5px;display:inline-block;border-radius:4px}
    .count{color:#666;margin-left:6px;font-size:90%}
    .gallery img{max-width:200px;margin:5px}
    .back{margin:10px 0;display:inline-block;cursor:pointer;color:blue}
    h1{margin:0 0 12px 0}
    footer{margin-top:36px;padding:18px;text-align:center;color:#666}
  </style>
</head>
<body>
  <h1>{{ site.full_name }}</h1>

  <div class="section">
    <strong>Albums:</strong>
    <div id="albums"></div>
  </div>

  <div class="section">
    <strong>Categories:</strong>
    <div id="categories"></div>
  </div>

  <div id="gallery" style="display:none"></div>

  <footer>
    Thanks for visiting this site — have a great day!
  </footer>

  <script>
    var files = [
      {% for file in site.static_files %}
        {% assign p = file.path %}
        {% if p contains 'images/' and (p contains '.jpg' or p contains '.jpeg' or p contains '.png' or p contains '.gif' or p contains '.webp') %}
          "{{ file.path | relative_url }}",
        {% endif %}
      {% endfor %}
    ];

    var albumsMap = {};
    var categoriesMap = {};

    files.forEach(function(path){
      var parts = path.replace(/^\/+/,'').split('/');
      if(parts.length < 3) return;
      var album = parts[1];
      albumsMap[album] = albumsMap[album] || [];
      albumsMap[album].push(path);

      var filename = parts[parts.length-1];
      var base = filename.replace(/\.[^/.]+$/,'');
      var first = base.split(/[^A-Za-z0-9]+/)[0] || base;
      var key = first.toLowerCase();
      var display = first.charAt(0).toUpperCase() + first.slice(1);
      categoriesMap[key] = categoriesMap[key] || { display: display, items: [] };
      categoriesMap[key].items.push(path);
    });

    var albumsEl = document.getElementById('albums');
    var categoriesEl = document.getElementById('categories');
    var galleryEl = document.getElementById('gallery');

    function makeNode(text, count, onClick){
      var el = document.createElement('div');
      el.className = 'item';
      el.textContent = text + ' ';
      var c = document.createElement('span'); c.className = 'count'; c.textContent = '('+count+')';
      el.appendChild(c);
      el.onclick = onClick;
      return el;
    }

    function renderAlbums(){
      albumsEl.innerHTML = '';
      Object.keys(albumsMap).sort().forEach(function(a){
        albumsEl.appendChild(makeNode(a, albumsMap[a].length, function(){ openGallery('Album: '+a, albumsMap[a]); }));
      });
    }

    function renderCategories(){
      categoriesEl.innerHTML = '';
      Object.keys(categoriesMap).sort().forEach(function(k){
        var c = categoriesMap[k];
        categoriesEl.appendChild(makeNode(c.display, c.items.length, function(){ openGallery('Category: '+c.display, c.items); }));
      });
    }

    function openGallery(title, items){
      albumsEl.style.display = 'none';
      categoriesEl.style.display = 'none';
      galleryEl.style.display = 'block';
      galleryEl.innerHTML = '<div class="back" onclick="closeGallery()">← Back</div><h2>'+title+'</h2><div class="gallery"></div>';
      var grid = galleryEl.querySelector('.gallery');
      items.forEach(function(src){
        var img = document.createElement('img'); img.src = src; img.alt = title; grid.appendChild(img);
      });
      window.scrollTo(0,0);
    }

    function closeGallery(){
      galleryEl.style.display = 'none';
      galleryEl.innerHTML = '';
      albumsEl.style.display = '';
      categoriesEl.style.display = '';
      window.scrollTo(0,0);
    }

    renderAlbums();
    renderCategories();
  </script>
</body>
</html>